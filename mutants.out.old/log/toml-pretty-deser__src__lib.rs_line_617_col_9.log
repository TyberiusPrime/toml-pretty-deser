
*** toml-pretty-deser/src/lib.rs:617:9: replace HydratedAnnotatedError::pretty -> String with "xyzzy".into()

*** mutation diff:
--- toml-pretty-deser/src/lib.rs
+++ replace HydratedAnnotatedError::pretty -> String with "xyzzy".into()
@@ -609,128 +609,17 @@
             span,
             msg: msg.to_string(),
         });
     }
 }
 
 impl HydratedAnnotatedError {
     pub fn pretty(&self, source_name: &str) -> String {
-        use bstr::{BStr, ByteSlice};
-        use codesnake::{Block, CodeWidth, Label, LineIndex};
-        use std::fmt::Write;
-
-        let source = self.source.borrow();
-
-        if !self.inner.spans.is_empty() {
-            let idx = LineIndex::new(&source);
-            let mut spans = self.inner.spans.clone();
-            spans.sort_by_key(|span| span.span.start);
-
-            let mut previous_newline =
-                memchr::memmem::rfind(&source.as_bytes()[..spans[0].span.start], b"\n");
-            let this_line_is_block_start = source.as_bytes()[previous_newline.unwrap_or(0)..]
-                .trim_ascii_start()
-                .starts_with(b"[");
-            if this_line_is_block_start {
-                previous_newline = None;
-            }
-
-            let mut labels = Vec::new();
-
-            for span in spans.into_iter() {
-                labels.push(Label::new(span.span).with_text(span.msg));
-            }
-
-            let block = Block::new(&idx, labels).unwrap_or_else(|| {
-                let mut spans = self.inner.spans.clone();
-                spans.sort_by_key(|span| span.span.start);
-                let span_str: Vec<_> = spans
-                    .iter()
-                    .map(|span| format!("{}..{}: {}", span.span.start, span.span.end, span.msg))
-                    .collect();
-                let span_str = span_str.join("\n");
-                let final_message = format!(
-                    "Error spans were overlapping so we were unable to process a pretty code block. Spans & messages:\n{}",
-                    span_str
-                );
-                let labels = vec![Label::new(0..0).with_text(final_message)];
-                Block::new(&idx, labels).expect("can not fail")
-            });
-
-            let (lines_before, digits_needed) = match previous_newline {
-                None => ("".to_string(), 1),
-                Some(previous_newline) => {
-                    let upto_span = &BStr::new(source.as_bytes())[..previous_newline];
-                    let lines: Vec<_> = upto_span.lines().collect();
-                    let str_line_no = format!("{}", lines.len());
-                    let digits_needed = str_line_no.len();
-                    let mut seen_opening = false;
-                    let mut lines_before: Vec<_> = lines
-                        .into_iter()
-                        .enumerate()
-                        .map(|(line_no, line)| (line_no, line))
-                        .rev()
-                        .take_while(move |x| {
-                            if BStr::new(x.1).trim_ascii_start().starts_with(b"[") {
-                                seen_opening = true;
-                                true
-                            } else {
-                                !seen_opening
-                            }
-                        })
-                        .map(|(line_no, line)| {
-                            format!(
-                                "{:>digits_needed$} │ {}",
-                                line_no + 1,
-                                std::string::String::from_utf8_lossy(line)
-                            )
-                        })
-                        .collect();
-                    lines_before.reverse();
-                    (lines_before.join("\n"), digits_needed)
-                }
-            };
-
-            let block = block.map_code(|c| CodeWidth::new(c, c.len()));
-            let mut out = String::new();
-            writeln!(&mut out, "{}{}", block.prologue(), source_name).expect("can't fail");
-            write!(&mut out, " {:digits_needed$}┆\n{}\n", " ", lines_before).expect("can't fail");
-            let blockf: String = format!("{}", block)
-                .lines()
-                .skip(1)
-                .map(|x| format!("{}\n", x))
-                .collect();
-            write!(&mut out, "{}", blockf).expect("can't fail");
-            writeln!(&mut out, "{}", block.epilogue()).expect("can't fail");
-
-            if let Some(help) = self.inner.help.as_ref() {
-                if !help.is_empty() {
-                    let mut first = true;
-                    write!(&mut out, "Hint: ").expect("Can't fail");
-                    for line in help.lines() {
-                        if !first {
-                            write!(&mut out, "      ").expect("can't fail");
-                        }
-                        first = false;
-                        writeln!(&mut out, "{}", line).expect("can't fail");
-                    }
-                }
-            }
-            out
-        } else {
-            format!(
-                "ConfigError at unknown location. Help text: {}",
-                self.inner
-                    .help
-                    .as_ref()
-                    .map(|x| x.as_str())
-                    .unwrap_or("None available")
-            )
-        }
+        "xyzzy".into() /* ~ changed by cargo-mutants ~ */
     }
 }
 
 /// Stores information about expected fields and their aliases
 #[derive(Debug, Clone)]
 pub struct FieldInfo {
     pub name: String,
     pub aliases: Vec<&'static str>,


*** /nix/store/826jircl576xphx7a459njgqfmcbd4x5-cargo-1.95.0-nightly-2026-01-21-x86_64-unknown-linux-gnu/bin/cargo test --no-run --verbose --package=toml-pretty-deser@0.1.0
       Fresh unicode-ident v1.0.22
       Fresh proc-macro2 v1.0.106
       Fresh autocfg v1.5.0
       Fresh quote v1.0.44
       Fresh equivalent v1.0.2
       Fresh hashbrown v0.16.1
       Fresh winnow v0.7.14
       Fresh syn v2.0.114
       Fresh regex-automata v0.4.13
       Fresh toml_datetime v0.7.5+spec-1.1.0
       Fresh toml_writer v1.0.6+spec-1.1.0
       Fresh memchr v2.7.6
       Fresh codesnake v0.2.1
       Fresh strsim v0.11.1
       Fresh toml_parser v1.0.6+spec-1.1.0
       Fresh indexmap v2.13.0
       Fresh toml-pretty-deser-macros v0.1.0 (/tmp/nix-shell.fWA0aw/cargo-mutants-toml-pretty-deser-Ha55Kf.tmp/toml-pretty-deser-macros)
       Fresh bstr v1.12.1
       Fresh num-traits v0.2.19
       Fresh toml_edit v0.24.0+spec-1.1.0
       Dirty toml-pretty-deser v0.1.0 (/tmp/nix-shell.fWA0aw/cargo-mutants-toml-pretty-deser-Ha55Kf.tmp/toml-pretty-deser): the file `toml-pretty-deser/src/lib.rs` has changed (1770035328.269477338s, 1s after last build at 1770035327.742499960s)
   Compiling toml-pretty-deser v0.1.0 (/tmp/nix-shell.fWA0aw/cargo-mutants-toml-pretty-deser-Ha55Kf.tmp/toml-pretty-deser)
     Running `rustc --crate-name toml_pretty_deser --edition=2024 toml-pretty-deser/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 --test --check-cfg 'cfg(docsrs,test)' --check-cfg 'cfg(feature, values())' -C metadata=857480bb847c9bbe -C extra-filename=-07d9828939c75c69 --out-dir /home/finkernagel/.cache/cargo/target/debug/deps -C incremental=/home/finkernagel/.cache/cargo/target/debug/incremental -L dependency=/home/finkernagel/.cache/cargo/target/debug/deps --extern bstr=/home/finkernagel/.cache/cargo/target/debug/deps/libbstr-4045620ba0449622.rlib --extern codesnake=/home/finkernagel/.cache/cargo/target/debug/deps/libcodesnake-4b12368228b7ace0.rlib --extern memchr=/home/finkernagel/.cache/cargo/target/debug/deps/libmemchr-ce879c287aae1239.rlib --extern num_traits=/home/finkernagel/.cache/cargo/target/debug/deps/libnum_traits-163a578cc7663ca5.rlib --extern strsim=/home/finkernagel/.cache/cargo/target/debug/deps/libstrsim-35e26dbaedb97986.rlib --extern toml_pretty_deser_macros=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_pretty_deser_macros-f792c9db6a0b2842.so --extern toml_edit=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_edit-6ba341dc50ff9c99.rlib -C link-arg=-fuse-ld=mold`
     Running `rustc --crate-name toml_pretty_deser --edition=2024 toml-pretty-deser/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 --check-cfg 'cfg(docsrs,test)' --check-cfg 'cfg(feature, values())' -C metadata=a852430a061c5350 -C extra-filename=-23ebeb13d54ac447 --out-dir /home/finkernagel/.cache/cargo/target/debug/deps -C incremental=/home/finkernagel/.cache/cargo/target/debug/incremental -L dependency=/home/finkernagel/.cache/cargo/target/debug/deps --extern bstr=/home/finkernagel/.cache/cargo/target/debug/deps/libbstr-4045620ba0449622.rmeta --extern codesnake=/home/finkernagel/.cache/cargo/target/debug/deps/libcodesnake-4b12368228b7ace0.rmeta --extern memchr=/home/finkernagel/.cache/cargo/target/debug/deps/libmemchr-ce879c287aae1239.rmeta --extern num_traits=/home/finkernagel/.cache/cargo/target/debug/deps/libnum_traits-163a578cc7663ca5.rmeta --extern strsim=/home/finkernagel/.cache/cargo/target/debug/deps/libstrsim-35e26dbaedb97986.rmeta --extern toml_pretty_deser_macros=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_pretty_deser_macros-f792c9db6a0b2842.so --extern toml_edit=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_edit-6ba341dc50ff9c99.rmeta -C link-arg=-fuse-ld=mold`
warning: unused variable: `source_name`
   --> toml-pretty-deser/src/lib.rs:616:26
    |
616 |     pub fn pretty(&self, source_name: &str) -> String {
    |                          ^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_source_name`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: field `allowed` is never read
   --> toml-pretty-deser/src/lib.rs:664:5
    |
656 | pub struct TomlHelper<'a> {
    |            ---------- field in this struct
...
664 |     allowed: HashMap<String, String>,
    |     ^^^^^^^
    |
    = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: `toml-pretty-deser` (lib test) generated 2 warnings (2 duplicates)
warning: `toml-pretty-deser` (lib) generated 2 warnings (run `cargo fix --lib -p toml-pretty-deser` to apply 1 suggestion)
     Running `rustc --crate-name basic --edition=2024 toml-pretty-deser/tests/basic.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 --test --check-cfg 'cfg(docsrs,test)' --check-cfg 'cfg(feature, values())' -C metadata=608c682146c4ede0 -C extra-filename=-c7883bdc8893c706 --out-dir /home/finkernagel/.cache/cargo/target/debug/deps -C incremental=/home/finkernagel/.cache/cargo/target/debug/incremental -L dependency=/home/finkernagel/.cache/cargo/target/debug/deps --extern bstr=/home/finkernagel/.cache/cargo/target/debug/deps/libbstr-4045620ba0449622.rlib --extern codesnake=/home/finkernagel/.cache/cargo/target/debug/deps/libcodesnake-4b12368228b7ace0.rlib --extern memchr=/home/finkernagel/.cache/cargo/target/debug/deps/libmemchr-ce879c287aae1239.rlib --extern num_traits=/home/finkernagel/.cache/cargo/target/debug/deps/libnum_traits-163a578cc7663ca5.rlib --extern strsim=/home/finkernagel/.cache/cargo/target/debug/deps/libstrsim-35e26dbaedb97986.rlib --extern toml_pretty_deser=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_pretty_deser-23ebeb13d54ac447.rlib --extern toml_pretty_deser_macros=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_pretty_deser_macros-f792c9db6a0b2842.so --extern toml_edit=/home/finkernagel/.cache/cargo/target/debug/deps/libtoml_edit-6ba341dc50ff9c99.rlib -C link-arg=-fuse-ld=mold`
warning: unused variable: `errors`
    --> toml-pretty-deser/tests/basic.rs:1002:41
     |
1002 |     if let Err(DeserError::DeserFailure(errors, output)) = result {
     |                                         ^^^^^^ help: if this is intentional, prefix it with an underscore: `_errors`
     |
     = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: `toml-pretty-deser` (test "basic") generated 1 warning (run `cargo fix --test "basic" -p toml-pretty-deser` to apply 1 suggestion)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.61s
  Executable `/home/finkernagel/.cache/cargo/target/debug/deps/toml_pretty_deser-07d9828939c75c69`
  Executable `/home/finkernagel/.cache/cargo/target/debug/deps/basic-c7883bdc8893c706`

*** result: Success

*** /nix/store/826jircl576xphx7a459njgqfmcbd4x5-cargo-1.95.0-nightly-2026-01-21-x86_64-unknown-linux-gnu/bin/cargo test --verbose --package=toml-pretty-deser@0.1.0
       Fresh unicode-ident v1.0.22
       Fresh proc-macro2 v1.0.106
       Fresh autocfg v1.5.0
       Fresh quote v1.0.44
       Fresh hashbrown v0.16.1
       Fresh winnow v0.7.14
       Fresh equivalent v1.0.2
       Fresh toml_parser v1.0.6+spec-1.1.0
       Fresh syn v2.0.114
       Fresh memchr v2.7.6
       Fresh toml_writer v1.0.6+spec-1.1.0
       Fresh toml_datetime v0.7.5+spec-1.1.0
       Fresh regex-automata v0.4.13
       Fresh codesnake v0.2.1
       Fresh strsim v0.11.1
       Fresh indexmap v2.13.0
       Fresh toml-pretty-deser-macros v0.1.0 (/tmp/nix-shell.fWA0aw/cargo-mutants-toml-pretty-deser-Ha55Kf.tmp/toml-pretty-deser-macros)
       Fresh num-traits v0.2.19
       Fresh bstr v1.12.1
       Fresh toml_edit v0.24.0+spec-1.1.0
warning: unused variable: `source_name`
   --> toml-pretty-deser/src/lib.rs:616:26
    |
616 |     pub fn pretty(&self, source_name: &str) -> String {
    |                          ^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_source_name`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: field `allowed` is never read
   --> toml-pretty-deser/src/lib.rs:664:5
    |
656 | pub struct TomlHelper<'a> {
    |            ---------- field in this struct
...
664 |     allowed: HashMap<String, String>,
    |     ^^^^^^^
    |
    = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: `toml-pretty-deser` (lib) generated 2 warnings (run `cargo fix --lib -p toml-pretty-deser` to apply 1 suggestion)
warning: `toml-pretty-deser` (lib test) generated 2 warnings (2 duplicates)
warning: unused variable: `errors`
    --> toml-pretty-deser/tests/basic.rs:1002:41
     |
1002 |     if let Err(DeserError::DeserFailure(errors, output)) = result {
     |                                         ^^^^^^ help: if this is intentional, prefix it with an underscore: `_errors`
     |
     = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

       Fresh toml-pretty-deser v0.1.0 (/tmp/nix-shell.fWA0aw/cargo-mutants-toml-pretty-deser-Ha55Kf.tmp/toml-pretty-deser)
warning: `toml-pretty-deser` (test "basic") generated 1 warning (run `cargo fix --test "basic" -p toml-pretty-deser` to apply 1 suggestion)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `/home/finkernagel/.cache/cargo/target/debug/deps/toml_pretty_deser-07d9828939c75c69`

running 2 tests
test tests::test_field_match_mode ... ok
test tests::test_normalize_no_case ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running `/home/finkernagel/.cache/cargo/target/debug/deps/basic-c7883bdc8893c706`

running 37 tests
test test_alias_exact_mode ... ok
test test_alias_with_any_case_mode ... ok
test test_any_case_mode_kebab ... ok
test test_any_case_mode_camel ... ok
test test_alias_exact_mode_failure ... ok
test test_any_case_mode_shouty ... ok
test test_any_case_mode_unknown_key ... ok
test test_any_case_mode_snake ... ok
test test_any_case_mode_upper_camel ... ok
test test_array_wrong_element_type ... ok
test test_any_case_mode_train ... ok
test test_arrays_and_nested ... ok
test test_complex_mixed_case ... ok
test test_arrays_with_optional ... ok
test test_complex_mixed_case_key_reused ... ok
test test_enum_missing_required ... ok
test test_enum_happy_path ... ok
test test_enum_optional_missing ... ok
test test_enum_invalid_variant ... ok
test test_nested_with_any_case_mode ... ok
test test_missing ... ok
test test_nested_happy_half ... ok
test test_nested_with_alias ... ok
test test_happy_path ... ok
test test_nested_happy ... ok
test test_optional_missing ... ok
test test_two_level_nested_inline_table ... ok
test test_two_errors_pretty ... FAILED
test test_two_level_nested_missing_inner ... ok
test test_two_level_nested_with_optional_nested ... ok
test test_upper_lower_mode ... ok
test test_range_validation ... ok
test test_vec_missing ... ok
test test_two_level_nested_happy ... ok
test test_wrong_type ... ok
test test_validation_failure ... ok
test test_two_level_nested_missing_inner_field ... ok

failures:

---- test_two_errors_pretty stdout ----
[toml-pretty-deser/tests/basic.rs:669:5] &result = Err(
    DeserFailure(
        [
            HydratedAnnotatedError {
                source: RefCell {
                    value: "\n        [level1]\n            name = 'l1'\n\n        [level1.level2]\n            other = 2\n            # missing data field\n        ",
                },
                inner: AnnotatedError {
                    spans: [
                        SpannedMessage {
                            span: 79..84,
                            msg: "Unknown key: other",
                        },
                    ],
                    help: Some(
                        "Did you mean: 'data'?",
                    ),
                },
            },
            HydratedAnnotatedError {
                source: RefCell {
                    value: "\n        [level1]\n            name = 'l1'\n\n        [level1.level2]\n            other = 2\n            # missing data field\n        ",
                },
                inner: AnnotatedError {
                    spans: [
                        SpannedMessage {
                            span: 51..66,
                            msg: "Missing required key: data",
                        },
                    ],
                    help: Some(
                        "This key is required but was not found in the TOML document.",
                    ),
                },
            },
        ],
        PartialRoot {
            level1: TomlValue {
                value: Some(
                    PartialLevel1 {
                        name: TomlValue {
                            value: Some(
                                "l1",
                            ),
                            state: Ok {
                                span: 37..41,
                            },
                            required: true,
                        },
                        level2: TomlValue {
                            value: Some(
                                PartialLevel2 {
                                    data: TomlValue {
                                        value: None,
                                        state: Missing {
                                            key: "data",
                                            parent_span: 51..66,
                                        },
                                        required: true,
                                    },
                                },
                            ),
                            state: ValidationFailed {
                                span: 51..66,
                                message: "Nested struct has errors",
                            },
                            required: true,
                        },
                        opt_level2: TomlValue {
                            value: Some(
                                None,
                            ),
                            state: Ok {
                                span: 0..0,
                            },
                            required: false,
                        },
                    },
                ),
                state: ValidationFailed {
                    span: 9..17,
                    message: "Nested struct has errors",
                },
                required: true,
            },
            opt_level1: TomlValue {
                value: Some(
                    None,
                ),
                state: Ok {
                    span: 0..0,
                },
                required: false,
            },
        },
    ),
)

thread 'test_two_errors_pretty' (2351058) panicked at toml-pretty-deser/tests/basic.rs:675:9:
assertion `left == right` failed
  left: "xyzzy"
 right: "  ╭─test.toml\n  ┆\n5 │         [level1.level2]\n6 │             other = 2\n  ┆             ──┬──    \n  ┆               │      \n  ┆               ╰─────── Unknown key: other\n──╯\nHint: Did you mean: 'data'?\n"
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    test_two_errors_pretty

test result: FAILED. 36 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

error: test failed, to rerun pass `-p toml-pretty-deser --test basic`

*** result: Failure(101)
